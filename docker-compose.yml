# Mini-NVR Docker Compose

services:
  nvr:
    build: .
    container_name: mini-nvr
    restart: always
    user: "${DOCKER_UID:-1000}:${DOCKER_GID:-1000}"  # Run as host user to fix file permissions
    env_file: .env
    network_mode: host  # Required to access go2rtc at localhost
    volumes:
      - ./recordings:/recordings
      - ./logs:/logs
      # NOTE: YouTube upload credentials not needed in Docker
      # YouTube upload now runs on HOST via start.sh

  # go2rtc for low-latency WebRTC live streaming
  # Also serves as central RTSP hub for YouTube streaming
  go2rtc:
    image: alexxit/go2rtc
    container_name: go2rtc
    restart: always
    network_mode: host  # Required for WebRTC STUN/TURN
    volumes:
      - ./go2rtc.yaml:/config/go2rtc.yaml:ro
    environment:
      - TZ=${TZ:-Asia/Kolkata}
