# Mini-NVR Docker Compose

services:
  nvr:
    build: .
    container_name: mini-nvr
    restart: always
    # Note: Running as root for SSH access. File permissions handled by volume mounts.
    env_file: .env
    network_mode: host  # Required to access go2rtc at localhost
    volumes:
      - ./recordings:/recordings
      - ./logs:/logs
      - ./encrypt:/app/encrypt
      # SSH keys for Docker-to-host auth triggering (mounted to root's ssh dir)
      - ${HOME}/.ssh/id_rsa:/root/.ssh/id_rsa:ro
      - ${HOME}/.ssh/known_hosts:/root/.ssh/known_hosts:ro
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - SSH_HOST_USER=${USER}
      - PROJECT_DIR=${PWD}

  # go2rtc for low-latency WebRTC live streaming
  # Also serves as central RTSP hub for YouTube streaming
  go2rtc:
    image: alexxit/go2rtc
    container_name: go2rtc
    restart: always
    network_mode: host  # Required for WebRTC STUN/TURN
    volumes:
      - ./go2rtc.yaml:/config/go2rtc.yaml:ro
    environment:
      - TZ=${TZ:-Asia/Kolkata}

